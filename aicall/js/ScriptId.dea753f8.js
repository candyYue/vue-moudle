(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"4fRq":function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},AaNj:function(t,e,n){},CoYH:function(t,e,n){"use strict";var i=n("G1D9");n.n(i).a},Cwky:function(t,e,n){"use strict";n.d(e,"f",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return s}),n.d(e,"b",function(){return l}),n.d(e,"d",function(){return c}),n.d(e,"e",function(){return u});var i=n("oI6n"),r={required:!0,message:"请输入话术内容",trigger:["blur","change"]},o={title:[{required:!0,message:"请输入话术名称",trigger:["blur","change"]},{validator:function(t,e,n){i.b.test(e)?n(new Error("请不要输入非法字符")):n()},trigger:["blur","change"]}],"noinput[0].text":[r,i.a],"noinput[1].text":[r,i.a],"noinput[2].text":[r,i.a],"nomatch[0].text":[r,i.a],"nomatch[1].text":[r,i.a],"nomatch[2].text":[r,i.a],intention:{validator:function(t,e,n){if(e.value&&!e.text)return n(new Error("请输入话术"));n()},trigger:["blur","change"]},session:{validator:function(t,e,n){if(e.value&&!e.text)return n(new Error("请输入话术"));n()},trigger:["blur","change"]}},a={cluster_id:{required:!0,message:"请选择聚类名称",trigger:["blur","change"]},script:[{required:!0,message:"请输入话术",trigger:["blur","change"]},{validator:function(t,e,n){i.b.test(e)?n(new Error("请不要输入非法字符")):n()},trigger:["blur","change"]}]},s={title:[{required:!0,message:"请输入聚类名称",trigger:["blur","change"]},i.a]},l={title:[{required:!0,message:"请输入字段内容",trigger:["blur","change"]},i.a]},c={title:[{required:!0,message:"请输入标签内容",trigger:["blur","change"]},i.a]},u={title:[{required:!0,message:"请输入短信名称",trigger:["blur","change"]},i.a],content:[{required:!0,message:"请输入短信内容",trigger:["blur","change"]},i.a]}},EcEN:function(t,e,n){var i=n("xDdU"),r=n("xk4V"),o=r;o.v1=i,o.v4=r,t.exports=o},G1D9:function(t,e,n){},I2ZF:function(t,e){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(t,e){var i=e||0,r=n;return r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]}},TanX:function(t,e,n){"use strict";n.r(e);n("yt8O");var i=n("MECJ"),r=(n("rGqo"),n("ls82"),n("KKXr"),n("iv4g")),o=(n("f3/d"),n("dRSK"),n("bHtr"),n("oyJW")),a=n("yT7P"),s=(n("91GP"),n("eulG")),l=n("L2JU"),c=n("RSMI"),u=n("t0Hw");var d=n("l2ex"),m=n("Cwky"),p=(n("xfY5"),n("EcEN")),h=n.n(p),f=n("X+n+"),v=n.n(f),b=n("VphZ"),g=n("9y2E"),y=function t(e){return e.map(function(e){return e.id=h.a.v4(),e._collapsed=!1,e.children&&e.children.length>0&&(e.children=t(e.children)),e})},x={name:"Link",props:{linkData:Object,transitionDuration:Number},data:function(){return{initStyle:{opacity:0}}},computed:{linkPath:function(){var t=this.linkData,e=[t.x,t.y-44],n=e[0],i=e[1],r=[t.parent.x,t.parent.y+44],o=r[0],a=r[1],s=0,l=parseInt(n-o);l>10&&(s=1),l<-10&&(s=-1);var c=(a-i)/2;return"M"+n+","+i+"Q"+n+","+(i+.9*c)+" "+(n+c*s)+","+(i+c)+"L"+(o-c*s)+","+(i+c)+"Q"+o+","+(i+1.2*c)+" "+o+","+a}},methods:{applyOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.transitionDuration?Object(b.c)(this.$refs["link-".concat(this.linkData.data.id)]).transition().duration(this.transitionDuration).style("opacity",t):Object(b.c)(this.$refs["link-".concat(this.linkData.data.id)]).style("opacity",t)}},mounted:function(){this.applyOpacity()},beforeDestroy:function(){this.applyOpacity(0)}},_=n("KHd+"),F=Object(_.a)(x,function(){var t=this.$createElement;return(this._self._c||t)("path",{ref:"link-"+this.linkData.data.id,staticClass:"vue-tree-link-base",style:this.initStyle,attrs:{d:this.linkPath}})},[],!1,null,null,null).exports,w=(n("/8Fb"),{name:"Node",components:{ForeignObjectElement:{name:"ForeignObjectElement",inject:["$$tree"],props:{nodeData:Object,renderForeignObjects:Function},created:function(){var t=this;if(this.$$tree.$scopedSlots){var e=this.$options.parent.$options.propsData.nodeData.data;this.$options.render=function(n){return n("div",[t.$$tree.$scopedSlots.default(e)])}}}}},props:{nodeData:Object,nodeSize:Object,nodeSvgShape:String,nodeSvgShapeAttr:Object,transitionDuration:Number,orientation:String,allowForeignObjects:Boolean,renderForeignObjects:Function},data:function(){return{transform:"",initStyle:{opacity:0}}},methods:{renderNodeElement:function(){var t=Object(b.c)(this.$refs[this.nodeData.data.id]).append(this.nodeSvgShape);Object.entries(this.nodeSvgShapeAttr).forEach(function(e){t.attr(e[0],e[1])})},setTransform:function(){var t=this.nodeData.x,e=this.nodeData.y,n="horizontal"===this.orientation?"translate(".concat(e,",").concat(t,")"):"translate(".concat(t,",").concat(e,")");this.applyTransform(n)},applyTransform:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=Object(b.c)(this.$refs[this.nodeData.data.id]);this.transitionDuration,i.attr("transform",t).attr("style","opacity: ".concat(e)),n()}},mounted:function(){this.setTransform()}}),C={name:"tree",provide:function(){return{$$tree:this}},components:{Link:F,Node:Object(_.a)(w,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{ref:t.nodeData.data.id,style:t.initStyle,attrs:{transform:t.transform}},[n("foreignObject",{attrs:{x:-t.nodeSize.x/2,y:-t.nodeSize.y/2,width:t.nodeSize.x,height:t.nodeSize.y}},[t.allowForeignObjects?n("ForeignObjectElement",{attrs:{nodeData:t.nodeData,renderForeignObjects:t.renderForeignObjects}}):t._e()],1)],1)},[],!1,null,null,null).exports},props:{initData:{type:Array,required:!0},orientation:{type:String,default:"vertical",validator:function(t){return Object(g.e)(t,["horizontal","vertical"])}},collapsible:{type:Boolean,default:!0},nodeSvgShape:{type:String,default:"circle"},nodeSvgShapeAttr:{type:Object,default:function(){return{r:10}}},pathFunc:{type:Function},nodeSize:{type:Object,default:function(){return{x:234,y:88}}},separation:{type:Object,default:function(){return{siblings:1.2,nonSiblings:1}}},zoomable:{type:Boolean,default:!1},scaleExtent:{type:Object,default:function(){return{min:.1,max:1}}},translate:{type:Object,default:function(){return{x:0,y:0}},validator:function(t){return"number"===Object(g.g)(t.x)&&"number"===Object(g.g)(t.y)}},transitionDuration:{type:Number,default:500},allowForeignObjects:Boolean,renderForeignObjects:{type:Function,default:function(){return""}}},data:function(){return{svgRef:h.a.v4(),gRef:h.a.v4(),data:y(this.initData),nodes:[],links:[],scaleValue:70,translateValue:this.translate}},computed:{scale:{get:function(){var t=this.scaleExtent,e=t.min,n=t.max,i=v.a.minus(n,e);return v.a.plus(v.a.times(i,v.a.divide(this.scaleValue,100)),e)},set:function(t){var e=this.scaleExtent,n=e.min,i=e.max,r=v.a.minus(i,n),o=v.a.minus(t,n);this.scaleValue=100*v.a.divide(o,r)}},treemap:function(){var t=this,e=this.nodeSize,n=e.x,i=e.y,r=Object(b.d)().nodeSize("horizontal"===this.orientation?[i,n/.9]:[n/.9,i]).separation(function(e,n){return e.parent.data.id===n.parent.data.id?t.separation.siblings:t.separation.nonSiblings});return r},root:function(){return Object(b.b)(this.data[0])},tree:function(){var t=this.treemap(this.root),e=t.descendants();e.forEach(function(t){t.y=180*t.depth});var n=t.descendants().slice(1);return e.forEach(function(t){t.y=.71*t.y}),{nodes:e,links:n}}},watch:{initData:function(t){this.data=y(t)},translate:function(t){this.translateValue=t}},methods:{bindZoomListener:function(){var t=this,e=this,n=Object(b.c)(this.$refs[this.svgRef]),i=Object(b.c)(this.$refs[this.gRef]);this.zoomable?n.call(Object(b.e)().scaleExtent([this.scaleExtent.min,this.scaleExtent.max]).on("zoom",function(){var e=[t.translate.x,t.translate.y],n=e[0],r=e[1],o=b.a.transform,a=o.x,s=o.y,l=o.k;i.attr("transform","translate(".concat(n+a,",").concat(r+s,") scale(").concat(l,")"))})):n.call(Object(b.e)().scaleExtent([1,1]).on("zoom",function(){var n=[t.translate.x,t.translate.y],i=n[0],r=n[1],o=b.a.transform,a=o.x,s=o.y;e.translateValue={x:i+a,y:r+s}}))},setInitialTreeDepth:function(t,e){t.forEach(function(t){t._collapsed=t.depth>=e})},changeScale:function(t){var e=this.scaleExtent,n=e.max,i=e.min,r=v.a.divide(v.a.minus(n,i),10);if(1===t){var o=v.a.plus(this.scale,r);this.scale=o>n?n:o}else{var a=v.a.minus(this.scale,r);this.scale=a<i?i:a}}},mounted:function(){this.bindZoomListener()}},k=Object(_.a)(C,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["vue-tree-container","vue-tree-grabbable"]},[n("svg",{ref:t.svgRef,attrs:{width:"100%",height:"100%"}},[n("transition",[n("g",{ref:t.gRef,attrs:{transform:"translate("+t.translateValue.x+","+t.translateValue.y+") scale("+t.scale+")"}},[t._l(t.tree.links,function(e,i){return n("Link",{key:i,attrs:{orientation:t.orientation,linkData:e,transitionDuration:t.transitionDuration}})}),t._l(t.tree.nodes,function(e){return n("Node",{key:e.data.id,attrs:{nodeData:e,nodeSize:t.nodeSize,transitionDuration:t.transitionDuration,orientation:t.orientation,nodeSvgShape:t.nodeSvgShape,nodeSvgShapeAttr:t.nodeSvgShapeAttr,allowForeignObjects:t.allowForeignObjects,renderForeignObjects:t.renderForeignObjects}})})],2)])],1),n("div",{staticClass:"vue-tree-tool-bar"},[n("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus"},on:{click:function(e){t.changeScale(1)}}}),n("el-slider",{attrs:{vertical:"","show-tooltip":!1,height:"98px"},model:{value:t.scaleValue,callback:function(e){t.scaleValue=e},expression:"scaleValue"}}),n("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-minus"},on:{click:function(e){t.changeScale(-1)}}})],1)])},[],!1,null,null,null).exports,$=n("WQji"),E=n("9qKe"),O=(n("rE2o"),n("ioFf"),"v-contextmenu-item--hover"),j={name:"editable-textarea",data:function(){return{selectOpts:this.selectList,textareaValue:this.value,fieldsShow:!1,fieldStyle:{top:0,left:0},selectionStart:0,context:{before:"",key:"",behind:""}}},props:{value:{type:String,default:""},selectList:{type:Array,default:function(){return[]}}},watch:{value:function(t){this.textareaValue=t},fieldsShow:function(t){this.selectOpts=t?this.selectList:[]},selectOpts:function(t){var e=this;this.fieldsShow&&t.length&&setTimeout(function(){e.selectOpts.length&&e.$refs.fields.firstChild.classList.add(O)},200)}},methods:{handleInput:function(t){this.$emit("input",this.textareaValue)},getFieldList:function(t){if(this.selectionStart=t.selectionStart,this.$set(this.context,"before",this.textareaValue.slice(0,this.selectionStart)),this.$set(this.context,"behind",this.textareaValue.slice(this.selectionStart)),this.selectList.length){var e=function(t,e){var n=t.getBoundingClientRect(),i=n.left,r=n.top,o=t.value,a=document.createElement("div"),s=document.createElement("span");a.classList.add("el-textarea__inner","el-textarea__copy"),a.innerText=o.substr(0,e),s.innerText=o.substr(e)||".",a.appendChild(s),document.body.appendChild(a);var l=s.getBoundingClientRect(),c=l.left,u=l.top,d=l.width,m=l.height;return document.body.removeChild(a),{x:i+c+d,y:r+u+m}}(t,this.selectionStart),n=[e.x,e.y],i=n[0],r=n[1];this.fieldsShow=!0,this.fieldStyle={top:r+"px",left:i+"px"}}},removeFieldList:function(){this.fieldsShow=!1},addFields:function(t){var e=this,n=this.$refs.script.$refs.textarea,i=this.context,r=i.before,o=i.behind;this.textareaValue="".concat(r).concat(t," ").concat(o),this.$emit("input",this.textareaValue),setTimeout(function(){var i=e.selectionStart+t.length+1;n.focus(),n.setSelectionRange(i,i)},20)},selFields:function(t){if(this.selectOpts.length&&this.fieldsShow){var e;document.createEvent("MouseEvents").initEvent("mouseover",!0,!1);var n=!0,i=!1,r=void 0;try{for(var o,a=this.$refs.fields.childNodes[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.classList.contains(O)&&(e=s,s.removeEventListener("mouseover",this.removeLight))}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}switch(t.which){case 13:t.stopPropagation(),t.preventDefault(),this.addFields(e.textContent.trim()),this.removeFieldList();break;case 38:e.previousSibling&&(this.hightLight(e.previousSibling),this.scroll(e.previousSibling));break;case 40:e.nextSibling&&(this.hightLight(e.nextSibling),this.scroll(e.nextSibling))}}},scroll:function(t){var e=this.$refs.fields,n=e.getBoundingClientRect().height,i=t.offsetTop+t.getBoundingClientRect().height;e.scrollTop=i-n>0?i-n:0},hightLight:function(t){var e=this;[].filter.call(this.$refs.fields.childNodes,function(t){return t!==e}).forEach(function(t){return t.classList.remove(O)}),t.classList.add(O)},removeLight:function(t){this.hightLight(t.target)}},mounted:function(){var t=this;document.body.addEventListener("click",function(e){t.fieldsShow=!1})}},I=(n("z/lk"),Object(_.a)(j,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-input",{ref:"script",attrs:{type:"textarea",maxlength:"200",autosize:{minRows:4,maxRows:4},placeholder:"示例：喂，您好，我们是XX公司，我们有一批公寓在售。"},on:{input:t.handleInput},model:{value:t.textareaValue,callback:function(e){t.textareaValue="string"==typeof e?e.trim():e},expression:"textareaValue"}})],1)},[],!1,null,"aae7d3e6",null).exports),S=n("Y+6y"),T=n("PEHn"),D=n("gXkj");function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n("HEwt"),n("6AQ9");var A,M,R={name:"Intention",props:{value:{type:Array,default:function(){return[]}}},watch:{value:{handler:function(t){this.intentionType=t},immediate:!0}},computed:Object(a.a)({},Object(l.c)({clustersList:"AICall/clustersList"}),{selectedKey:function(){var t=this.intentionType,e=function(t){return t.reduce(function(t,e){return Object(r.a)(t).concat(Object(r.a)(e))})};return e(Array.of(e(Array.from(t,function(t){return t.inKeywords})),e(Array.from(t,function(t){return t.outKeywords}))))}}),data:function(){var t=this,e=function(e,n){return function(i,r,o){var a={};if(r){var s=!0,l=!1,c=void 0;try{for(var u,d=t.intentionType[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var m=u.value;if(a[m[e]]===r)return o(new Error("已存在该".concat(n,"，请重新选择")));a[m[e]]=m[e]}}catch(t){l=!0,c=t}finally{try{s||null==d.return||d.return()}finally{if(l)throw c}}}o()}};return{intentionType:this.value,intentionRules:{type:{validator:e("type","意向性"),trigger:"change"},round:{validator:e("sessionNum","会话轮数"),trigger:"change"},keyword:{required:!0,message:"请添加关键词",trigger:"none"},duration:{validator:function(t,e,n){if(0===e.type){var i=L(e.area,2),r=i[0],o=i[1];if(!r)return n(new Error("请输入开始时间"));if(!o)return n(new Error("请输入结束时间"));if(+r>+o)return n(new Error("结束时间不得早于开始时间"))}n()},trigger:"none"}}}},methods:{handleIntentionType:function(t,e){switch(t){case 1:this.intentionType.length<4&&this.intentionType.push({type:"",inKeywords:[],num:"",outKeywords:[],sessionNum:"",duration:{type:"",area:["",""]}});break;case-1:this.intentionType.splice(e,1)}},resetDuration:function(t){this.intentionType[t].duration.area=["",""],this.$refs.durationArea[t].clearValidate()}}},N=Object(_.a)(R,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"intention"},[t._l(t.intentionType,function(e,i){return n("div",{key:"intention-"+i,staticClass:"intention-item"},[n("el-form-item",{staticClass:"intention__type script-form-item",attrs:{label:"意向性",prop:"intentionType["+i+"].type",rules:t.intentionRules.type}},[n("el-select",{attrs:{clearable:""},model:{value:e.type,callback:function(n){t.$set(e,"type",n)},expression:"intentionItem.type"}},t._l(["A","B","C","D"],function(t){return n("el-option",{key:t,attrs:{label:t+"类意向性",value:t}})})),0!==i?n("el-button",{staticClass:"button__del",attrs:{icon:"el-icon-minus"},on:{click:function(e){t.handleIntentionType(-1,i)}}}):t._e()],1),e.type?[n("el-form-item",{staticClass:"script-form-item",attrs:{label:"包含关键词",prop:"intentionType["+i+"].inKeywords",rules:t.intentionRules.keyword}},[n("el-select",{staticClass:"select-keywords",attrs:{size:"medium",multiple:"",placeholder:"请选择关键词"},model:{value:e.inKeywords,callback:function(n){t.$set(e,"inKeywords",n)},expression:"intentionItem.inKeywords"}},t._l(t.clustersList,function(i){return n("el-option",{key:i.id,attrs:{disabled:t.selectedKey.filter(function(t){return!e.inKeywords.includes(t)}).includes(i.id),title:t.selectedKey.filter(function(t){return!e.inKeywords.includes(t)}).includes(i.id)&&"不能添加相同的关键词",label:i.title,value:i.id}})})),n("el-input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"intention__num error__disabled",attrs:{placeholder:"命中个数"},model:{value:e.num,callback:function(n){t.$set(e,"num",n)},expression:"intentionItem.num"}})],1),n("el-form-item",{attrs:{label:"不包含关键词"}},[n("el-select",{staticClass:"select-keywords",attrs:{size:"medium",multiple:"",placeholder:"请选择不包含关键词"},model:{value:e.outKeywords,callback:function(n){t.$set(e,"outKeywords",n)},expression:"intentionItem.outKeywords"}},t._l(t.clustersList,function(i){return n("el-option",{key:i.id,attrs:{disabled:t.selectedKey.filter(function(t){return!e.outKeywords.includes(t)}).includes(i.id),title:t.selectedKey.filter(function(t){return!e.outKeywords.includes(t)}).includes(i.id)&&"不能添加相同的关键词",label:i.title,value:i.id}})}))],1),n("el-form-item",{attrs:{label:"会话轮数",prop:"intentionType["+i+"].sessionNum",rules:t.intentionRules.round}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.sessionNum,callback:function(n){t.$set(e,"sessionNum",n)},expression:"intentionItem.sessionNum"}},t._l(20,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}))],1),n("el-form-item",{ref:"durationArea",refInFor:!0,staticClass:"duration-area",attrs:{label:"通话时间",prop:"intentionType["+i+"].duration",rules:t.intentionRules.duration}},[n("el-select",{staticClass:"error__disabled",attrs:{clearable:""},on:{change:function(e){t.resetDuration(i)}},model:{value:e.duration.type,callback:function(n){t.$set(e.duration,"type",n)},expression:"intentionItem.duration.type"}},[n("el-option",{attrs:{label:"区间",value:0}}),n("el-option",{attrs:{label:"大于",value:1}}),n("el-option",{attrs:{label:"小于",value:-1}})],1),0===e.duration.type?n("div",{staticClass:"el-duration-range el-date-editor el-range-editor el-input__inner el-date-editor--timerange"},[n("el-input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"el-range-input",attrs:{placeholder:"请输入秒数"},model:{value:e.duration.area[0],callback:function(n){t.$set(e.duration.area,0,n)},expression:"intentionItem.duration.area[0]"}}),n("span",{staticClass:"el-range-separation"},[t._v("—")]),n("el-input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"el-range-input",attrs:{placeholder:"请输入秒数"},model:{value:e.duration.area[1],callback:function(n){t.$set(e.duration.area,1,n)},expression:"intentionItem.duration.area[1]"}})],1):t._e(),1===e.duration.type?n("el-input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"el-duration-range",attrs:{placeholder:"请输入秒数"},model:{value:e.duration.area[0],callback:function(n){t.$set(e.duration.area,0,n)},expression:"intentionItem.duration.area[0]"}}):t._e(),-1===e.duration.type?n("el-input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"el-duration-range",attrs:{placeholder:"请输入秒数"},model:{value:e.duration.area[1],callback:function(n){t.$set(e.duration.area,1,n)},expression:"intentionItem.duration.area[1]"}}):t._e()],1)]:t._e()],2)}),4!==t.intentionType.length?n("el-form-item",{staticStyle:{margin:"30px 0"}},[n("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",plain:""},on:{click:function(e){t.handleIntentionType(1)}}},[t._v("增加意向性")])],1):t._e()],2)},[],!1,null,null,null).exports,V={name:"TreeNode",props:["nodeData","cluster","rootEdited"],computed:Object(a.a)({},Object(l.c)({clustersMap:"AICall/clustersMap"})),methods:{handleContextMenu:function(t){t.preventDefault(),this.$emit("handleContextMenu",t,this.nodeData)}},render:function(t){var e=Object(c.d)(this.nodeData),n=!this.nodeData.children||0===this.nodeData.children.length,i=e.type,r=e.script,o=e.clusterId,a=e.default,s=e.bargein,l=e.instructManual,u=e.instructSms,d=e.allowJump,m=this.clustersMap.get(o),p=[{name:"mainprocess",value:a,title:"未匹配继续流程"},{name:"bargein",value:s,title:"允许打断"},{name:"manual",value:l,title:"转为人工坐席"},{name:"sms",value:u,title:"发送短信"},{name:"jump",value:d,title:"问题跳转话术"},{name:"end",value:n,title:"结束"}],h=!1;return this.rootEdited&&"root"===i&&(h=!m||!r),"root"!==i&&(h=!m||!r),t("div",{class:"base-ivrnode ".concat(h?"has-error":""),on:{contextmenu:this.handleContextMenu}},[t("p",{class:"ivrnode-props"},[p.map(function(e){if(e.value)return t("span",{class:e.name,attrs:{title:e.title}})})]),t("p",{attrs:{title:m}},["聚类：",m]),t("p",{attrs:{title:r}},["话术：",r])])}},H=n("mrpR"),K=(n("ZNLe"),{components:{Tree:k,TreeNode:V,Breadcrumb:E.a,Contextmenu:H.Contextmenu,ContextmenuItem:H.ContextmenuItem,Tooltip:$.a,EditableTextarea:I,Loading:S.a,VoiceUpload:T.a,Intention:N},data:function(){var t=this;return{fullLoading:!0,scriptTooltip:d.b.script,messageDispaly:d.a.script,treeHandler:d.c.TREE_HANDLER,type:null,copySource:null,treeData:[c.c.treeData],treeXml:"",translate:{x:0,y:0},scriptId:this.$route.params.id,scriptRules:m.f,scriptForm:{title:"",noinput:[{text:"喂？您好？",audio:{},voiceError:""},{text:"请问您在听吗？",audio:{},voiceError:""},{text:"不好意思，这边听不到您的声音，后期再与您联系，祝您生活愉快，再见。",audio:{},voiceError:""}],nomatch:[{text:"不好意思，您说什么？",audio:{},voiceError:""},{text:"我这边没听清，您能说的慢一点吗？",audio:{},voiceError:""},{text:"不好意思，我这边信号不太好，稍后由负责接待您的客户经理给您去电话，再见。",audio:{},voiceError:""}],instruct:[["none",""],["none",""],["onhook",""]],intention:{value:0,text:"",audio:{},voiceError:"",instruct:["onhook",""]},session:{value:0,text:"",audio:{},voiceError:"",instruct:["onhook",""]},intentionType:[{type:"",inKeywords:[],num:"",outKeywords:[],sessionNum:"",duration:{type:"",area:["",""]}}]},intentionOptions:["A","B","C","D","E","F"],scriptFormLoading:!1,ivrnodeRules:Object.assign(m.c,{instruct_manual:{validator:function(e,n,i){if(n&&!t.ivrnodeForm.manual_pid)return i(new Error("请选择技能组"));i()},trigger:"change"},instruct_sms:{validator:function(e,n,i){if(n&&!t.ivrnodeForm.sms_template_id)return i(new Error("请选择短信"));i()},trigger:"change"}}),ivrnodeModal:!1,ivrnodeForm:{id:null,cluster_id:"",default:!1,script:"",audio:null,voiceError:"",label_id:[],bargein:!1,instruct_manual:!1,manual_pid:"",instruct_sms:!1,sms_template_id:"",allow_jump:!1,process_end:!1,node_end:!0},targetNode:null,showError:!1,rootEdited:!1}},computed:Object(a.a)({},Object(l.c)({scriptsCache:"AICall/scriptsCache",clustersMap:"AICall/clustersMap",clustersList:"AICall/clustersList",fieldsList:"AICall/fieldsList",labelsList:"AICall/labelsList",labelsOptions:"AICall/labelsOptions",messagesList:"AICall/messagesList",serviceGroups:"AICall/serviceGroups",EpInfo:"AICall/EpInfo"}),{ivrnodeModalTitle:function(){var t;return(t={},Object(o.a)(t,this.treeHandler.ADD,"新增节点"),Object(o.a)(t,this.treeHandler.EDIT,"编辑节点"),t)[this.type]},nomatchDisabled:function(){var t=[!1,!1,!1];return this.callcenter&&this.scriptForm.instruct.map(function(e,n){"manual"===e[0]&&t.fill(!0,n+1,3)}),t},matchList:function(){var t=this.ivrnodeForm.cluster_id,e=[];return t&&(e=this.clustersList.find(function(e){return e.id===t})),e},rootEmpty:function(){return 0===this.treeData[0].prompt[0].tts[0].text.length},callcenter:function(){return"1"===this.EpInfo.enterprise_type}}),watch:{ivrnodeForm:{handler:function(t){this.callcenter&&t.bargein&&(this.ivrnodeForm.instruct_manual=!1,this.ivrnodeForm.manual_pid="")},deep:!0}},methods:Object(a.a)({},Object(l.b)({getClusters:"AICall/getClusters",getFields:"AICall/getFields",getLabels:"AICall/getLabels",getMessages:"AICall/getMessages",saveScripts:"AICall/saveScripts",saveScriptsCache:"AICall/saveScriptsCache",getServiceGroups:"AICall/getServiceGroups",getEpInfo:"AICall/getEpInfo"}),{getUploadInfo:function(t,e){switch(d.c.CATCH_TYPES[e.type]){case 0:this.ivrnodeForm.audio=t[0];break;case 1:this.scriptForm[e.type][e.index].audio=t[0];break;case 2:this.scriptForm[e.type].audio=t[0]}},instructOptions:function(t){var e=this.serviceGroups.map(function(t){return{value:t.gid,label:t.name}}),n=[1===t?{value:"none",label:"无指令"}:{value:"onhook",label:"挂机"},{value:"manual",label:"转为人工坐席",children:e}];return n},setTreeCenter:function(){var t=this.$refs.treeContainer.$el.getBoundingClientRect();this.translate={x:t.width/2,y:75}},getCatch:function(t){var e,n=this,i=(e={},Object(o.a)(e,d.c.PROMPT.MIX,"audio"),Object(o.a)(e,d.c.PROMPT.TTS,"tts"),e)[d.c.PROMPT_TYPE];t.map(function(t){var e=t.attr.event.value,o=d.c.CATCH_TYPES[e];if("nomatch"===e){var a=Object.assign.apply(Object,Object(r.a)(Object(c.a)(t.attr))),s=a.instruct,l=a.manual_pid;n.scriptForm.instruct.splice(t.prompt.length-1,1,[s,l])}switch(o){case 1:t.prompt.map(function(e,o){var a=Object.assign.apply(Object,Object(r.a)(Object(c.a)(e[i][0].attr)));n.scriptForm[t.attr.event.value].splice(o,1,{text:e[i][0].text,audio:a})});break;case 2:if(e){var u=Object.assign.apply(Object,Object(r.a)(Object(c.a)(t.attr))),m=u.rank,p=u.instruct,h=u.manual_pid,f=Object.assign.apply(Object,Object(r.a)(Object(c.a)(t.prompt[0].audio[0].attr)));n.scriptForm[e]=Object.assign(n.scriptForm[e],{value:m,instruct:[p,h],audio:f,text:t.prompt[0].audio[0].text})}}})},getIntentionType:function(t){var e=this;if(t){var n=[];t.map(function(t){var i,o=Object.assign.apply(Object,Object(r.a)(Object(c.a)(t.attr))),a=o.type,s=o["session-num"]||"",l=(o["duration-area"]||"#,#").split(","),u=0;l.indexOf("#")>-1&&(u="","#"!==l[0]&&(u=1),"#"!==l[1]&&(u=-1)),n.push({type:a,inKeywords:t["in-clusters"][0].item.map(function(t){return t.text}),num:t["in-clusters"][0].attr.num.value||"",outKeywords:(null===(i=t["out-clusters"][0].item)||void 0===i?void 0:i.map(function(t){return t.text}))||[],sessionNum:s,duration:{type:u,area:l}}),e.scriptForm.intentionType=n})}},changeArtificial:function(t){var e=this;if(e.ivrnodeForm.bargein)return!1;if(e.ivrnodeForm.manual_pid="",t){if(this.targetNode.children)return void D.a.$warning({content:e.messageDispaly.manualEdit,successCallback:function(){e.ivrnodeForm.instruct_manual=t,D.b.$success({content:"设置成功"})}});this.ivrnodeForm.instruct_manual=t}else this.ivrnodeForm.instruct_manual=t,this.$refs.ivrnodeForm.validateField("instruct_manual")},changeSms:function(t){t?this.ivrnodeForm.sms_template_id="":this.$refs.ivrnodeForm.validateField("instruct_sms")},resetIvrnodeForm:function(){this.$refs.ivrnodeForm.resetFields(),Object.assign(this.ivrnodeForm,{audio:null,voiceError:"",default:!1,label_id:[],instruct_manual:!1,manual_pid:"",instruct_sms:!1,sms_template_id:"",bargein:!1,process_end:!1,node_end:!0,allow_jump:!1}),this.$refs.ivrnodeUpload.resetUpload(),this.targetNode=null},closeIvrnodeModal:function(){this.ivrnodeModal=!1},openIvrnodeModal:function(t){this.resetIvrnodeForm(),this.targetNode=c.c.getNode(this.ivrnodeForm.id);var e=Object(c.d)(this.targetNode.data),n=e.default,i=e.clusterId,r=e.labelId,o=e.instructManual,a=e.manualPid,s=e.instructSms,l=e.smsTemplateId,u=e.script,d=e.audio,m=e.bargein,p=e.processEnd,h=e.allowJump;if(t===this.treeHandler.ADD){if(this.rootEmpty)return D.b.$error({content:this.messageDispaly.rootEmptyAdd}),!1;if(o)return D.b.$error({content:this.messageDispaly.manualEnd}),!1}if(t===this.treeHandler.EDIT){var f=r?r.split("-"):[];this.ivrnodeForm=Object.assign(this.ivrnodeForm,{cluster_id:i,default:n,script:u,label_id:f,bargein:m,audio:d,instruct_manual:o,manual_pid:a,instruct_sms:s,sms_template_id:l,process_end:!this.targetNode.children&&p,node_end:!this.targetNode.children,allow_jump:h}),!this.matchList&&(this.ivrnodeForm.cluster_id="")}this.type=t,this.ivrnodeModal=!0},checkVoice:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"请上传语音",i=null===(e=t.audio)||void 0===e?void 0:e.audio_id;return i||this.$set(t,"voiceError",n),i},checkForm:function(t){var e=this,n=!1;if(this.$refs[t].validate(function(t){return n=t}),"scriptForm"===t){this.showError=!0;var i=this.scriptForm.noinput.reduce(function(t,n,i){return e.checkVoice(e.scriptForm.noinput[i])&&t},!0),r=this.scriptForm.nomatch.reduce(function(t,n,i){return e.nomatchDisabled[i]?t:e.checkVoice(e.scriptForm.nomatch[i])&&t},!0),o=!0;this.scriptForm.intention.value&&(o=this.checkVoice(this.scriptForm.intention));var a=!0;return this.scriptForm.session.value&&(a=this.checkVoice(this.scriptForm.session)),n&&i&&r&&o&&a}if("ivrnodeForm"===t)return this.checkVoice(this.ivrnodeForm,"请选择语音文件")&&n},handleCopy:function(){if(this.rootEmpty)return D.b.$error({content:this.messageDispaly.rootEmptyCopy}),!1;this.type=this.treeHandler.COPY,this.copySource=this.ivrnodeForm.id},handleTree:function(t){if(this.type=t,this.rootEdited=!0,t===this.treeHandler.PASTE){if(Object(c.d)(c.c.getNode(this.ivrnodeForm.id).data).instructManual)return void D.b.$error({content:this.messageDispaly.manualCopy});c.c[t](this.ivrnodeForm.id,this.copySource)}else c.c[t](this.ivrnodeForm);this.treeData=[c.c.treeData],this.closeIvrnodeModal()},saveIvrnode:function(){this.checkForm("ivrnodeForm")&&this.handleTree(this.type)},removeNode:function(){var t=this;if("root"===Object(c.d)(c.c.getNode(this.ivrnodeForm.id).data).type)return D.b.$error({content:this.messageDispaly.rootRemove}),!1;D.a.$warning({title:"删除提示",content:this.messageDispaly.removeNode,successCallback:function(){t.handleTree(t.treeHandler.REMOVE)}})},mainprocessTip:function(){var t=this,e=null,n=Object(c.d)(this.targetNode.data),i=n.type,r=n.default;if(this.type===this.treeHandler.ADD&&(e=this.targetNode.data),this.type===this.treeHandler.EDIT){if("root"===i)return void(t.ivrnodeForm.default=!t.ivrnodeForm.default);e=this.targetNode.parent.data}!r&&Object(c.b)(e,"default")?D.a.$warning({title:"变更提示",content:this.messageDispaly.changeMainProcess,successCallback:function(){t.ivrnodeForm.default=!0,D.b.$success({content:"设置成功"})}}):t.ivrnodeForm.default=!t.ivrnodeForm.default},handleContextMenu:function(t,e){var n,i,r,o,a,s,l,c=this.$refs.contextmenu,u=t.target;c.show((i=u,r=(n=t).clientX||n.touches&&n.touches[0].pageX,o=n.clientY||n.touches&&n.touches[0].pageY,a=i.getBoundingClientRect(),s={top:o,left:r},l=document.body.getBoundingClientRect().x||document.body.getBoundingClientRect().left,s.left=s.left-l,o+a.height>document.body.clientHeight&&(s.top=document.body.clientHeight-a.height-80),s)),this.ivrnodeForm.id=e.id},getAudioIds:regeneratorRuntime.mark(function t(e,n){var i,o,a,s,l,c,u,d,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n,t.next=0===t.t0?3:1===t.t0?15:25;break;case 3:i=Object(r.a)(e),o=0;case 5:if(!(o<i.length)){t.next=14;break}if(!(c=i[o]).children){t.next=9;break}return t.delegateYield(this.getAudioIds(c.children,n),"t1",9);case 9:return t.next=11,(null===(a=c.prompt[0].tts[0])||void 0===a?void 0:null===(s=a.attr)||void 0===s?void 0:null===(l=s.audio_id)||void 0===l?void 0:l.value)||c.prompt[0].audio[0].attr.audio_id.value;case 11:o++,t.next=5;break;case 14:return t.abrupt("break",25);case 15:u=Object(r.a)(e),d=0;case 17:if(!(d<u.length)){t.next=24;break}return m=u[d],t.next=21,m.audio.audio_id;case 21:d++,t.next=17;break;case 24:return t.abrupt("break",25);case 25:case"end":return t.stop()}},t,this)}),saveForm:function(){var t=this,e=c.c.checkTree(this.clustersList);if(this.checkForm("scriptForm")&&!this.rootEmpty&&0===e){this.scriptFormLoading=!0;var n=Object(u.a)(t.scriptForm,t.treeData,{clustersMap:t.clustersMap,clustersList:t.clustersList,labelsList:t.labelsOptions,fieldsList:t.fieldsList});this.treeXml=n;var i=Object(r.a)(this.getAudioIds(this.treeData,0)).concat(Object(r.a)(this.getAudioIds(this.scriptForm.noinput,1)),Object(r.a)(this.getAudioIds(this.scriptForm.nomatch,1))),o={title:t.scriptForm.title,script:encodeURI(n),audio_ids:i},a=t.$route.meta,s=a.limit,l=a.page;"new"!==this.scriptId?o.id=this.scriptId:l=1,t.saveScripts(o).then(function(e){0===e.status&&(t.saveScriptsCache({id:t.scriptId,content:null}),D.b.$success({content:"保存成功",callback:function(){t.$router.push({name:"AICall-talk-script",query:{limit:s,page:l}})}})),t.scriptFormLoading=!1})}},getScript:(M=Object(i.a)(regeneratorRuntime.mark(function t(e){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new s.b(e),t.next=3,n.getScriptTree();case 3:i=t.sent,this.rootEdited=!0,this.scriptForm.title=n.title,this.getCatch(n.tree.catch),this.getIntentionType(n.tree["intention-type"]),c.c.initData(i[0]),this.treeData=i,c.c.checkTree(this.clustersList),this.fullLoading.close();case 12:case"end":return t.stop()}},t,this)})),function(t){return M.apply(this,arguments)})}),mounted:(A=Object(i.a)(regeneratorRuntime.mark(function t(){var e,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.fullLoading=this.$loading({lock:!0,background:"rgba(180, 188, 205, 0.35)"}),this.setTreeCenter(),t.next=4,this.getEpInfo();case 4:e=[this.getClusters(),this.getLabels()],this.EpInfo.sms_count&&e.push(this.getMessages()),this.callcenter&&e.push(this.getServiceGroups()),Promise.all(e).then(function(){"new"!==n.scriptId?n.getScript(n.scriptId):n.fullLoading.close()});case 8:case"end":return t.stop()}},t,this)})),function(){return A.apply(this,arguments)}),destroyed:function(){this.fullLoading.close(),c.c.resetData(),this.treeData=[c.c.treeData]}}),P=(n("nj8o"),Object(_.a)(K,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Breadcrumb",{attrs:{pathKey:"script"}}),n("el-form",{ref:"scriptForm",staticClass:"form-has-tootip script-form",attrs:{model:t.scriptForm,rules:t.scriptRules,"label-width":"130px"},nativeOn:{submit:function(t){t.preventDefault()}}},[n("el-form-item",{attrs:{label:"话术名称",prop:"title"}},[n("el-input",{attrs:{placeholder:"请输入话术名称",maxlength:"20"},model:{value:t.scriptForm.title,callback:function(e){t.$set(t.scriptForm,"title","string"==typeof e?e.trim():e)},expression:"scriptForm.title"}})],1),n("el-form-item",{attrs:{label:"话术流程",required:""}},[n("div",{class:["tree-process",t.rootEmpty&&t.showError?"error":""]},[n("Tree",{ref:"treeContainer",attrs:{translate:t.translate,initData:t.treeData,scaleExtent:{min:.2,max:1.2},allowForeignObjects:!0},scopedSlots:t._u([{key:"default",fn:function(e){return[n("tree-node",{attrs:{nodeData:e,rootEdited:t.rootEdited},on:{handleContextMenu:t.handleContextMenu}})]}}])}),t.rootEmpty&&t.showError?n("p",{staticClass:"el-form-item__error"},[t._v("请编辑话术流程")]):t._e()],1)]),n("h6",{staticClass:"is-required"},[n("label",[t._v("静音超时")]),n("Tooltip",{attrs:{content:t.scriptTooltip.noinput}})],1),t._l(t.scriptForm.noinput,function(e,i){return n("el-form-item",{key:"noinput-"+i,staticClass:"script-form-item",attrs:{label:"第"+(i+1)+"遍话术",prop:"noinput["+i+"].text"}},[n("el-input",{attrs:{placeholder:"请输入话术内容",maxlength:"60"},model:{value:t.scriptForm.noinput[i].text,callback:function(e){t.$set(t.scriptForm.noinput[i],"text","string"==typeof e?e.trim():e)},expression:"scriptForm.noinput[index].text"}}),n("voice-upload",{attrs:{fileInfo:t.scriptForm.noinput[i].audio,errorInfo:t.scriptForm.noinput[i].voiceError},on:{getUploadInfo:function(e){t.getUploadInfo(arguments,{type:"noinput",index:i})}}})],1)}),n("h6",{staticClass:"is-required"},[n("label",[t._v("未匹配到聚类")]),t.callcenter?n("Tooltip",{attrs:{content:t.scriptTooltip.nomatchCall}}):n("Tooltip",{attrs:{content:t.scriptTooltip.nomatch}})],1),t._l(t.scriptForm.nomatch,function(e,i){return n("el-form-item",{key:"nomatch-"+i,staticClass:"script-form-item",attrs:{label:"第"+(i+1)+"次提问",prop:"nomatch["+i+"].text"}},[n("el-input",{attrs:{placeholder:"请输入话术内容",maxlength:"60",disabled:t.nomatchDisabled[i]},model:{value:t.scriptForm.nomatch[i].text,callback:function(e){t.$set(t.scriptForm.nomatch[i],"text","string"==typeof e?e.trim():e)},expression:"scriptForm.nomatch[index].text"}}),n("voice-upload",{attrs:{fileInfo:t.scriptForm.nomatch[i].audio,errorInfo:t.scriptForm.nomatch[i].voiceError,disabled:t.nomatchDisabled[i]},on:{getUploadInfo:function(e){t.getUploadInfo(arguments,{type:"nomatch",index:i})}}}),t.callcenter?[n("el-cascader",{staticClass:"nomatch-instruct",attrs:{disabled:t.nomatchDisabled[i],"show-all-levels":!1,options:2==i?t.instructOptions(2):t.instructOptions(1)},model:{value:t.scriptForm.instruct[i],callback:function(e){t.$set(t.scriptForm.instruct,i,e)},expression:"scriptForm.instruct[index]"}})]:t._e()],2)}),t.callcenter?[n("h6",[n("label",[t._v("转人工坐席设置")]),n("Tooltip",{attrs:{content:t.scriptTooltip.manual}})],1),n("el-form-item",{attrs:{label:"根据意向性"}},[n("el-select",{staticClass:"manual-select",model:{value:t.scriptForm.intention.value,callback:function(e){t.$set(t.scriptForm.intention,"value",e)},expression:"scriptForm.intention.value"}},[n("el-option",{attrs:{label:"关闭",value:0}}),t._l(t.intentionOptions,function(t){return n("el-option",{key:t,attrs:{label:t+"类意向性",value:t}})})],2),n("el-cascader",{staticClass:"manual-instruct",attrs:{"show-all-levels":!1,options:t.instructOptions(2)},model:{value:t.scriptForm.intention.instruct,callback:function(e){t.$set(t.scriptForm.intention,"instruct",e)},expression:"scriptForm.intention.instruct"}})],1),0!==t.scriptForm.intention.value?n("el-form-item",{attrs:{label:"话术",prop:"intention"}},[n("el-input",{attrs:{placeholder:"请输入该意向转人工时播放的话术",maxlength:"60"},model:{value:t.scriptForm.intention.text,callback:function(e){t.$set(t.scriptForm.intention,"text",e)},expression:"scriptForm.intention.text"}}),n("voice-upload",{attrs:{fileInfo:t.scriptForm.intention.audio,errorInfo:t.scriptForm.intention.voiceError},on:{getUploadInfo:function(e){t.getUploadInfo(arguments,{type:"intention"})}}})],1):t._e(),n("el-form-item",{attrs:{label:"根据会话轮数"}},[n("el-select",{staticClass:"manual-select",model:{value:t.scriptForm.session.value,callback:function(e){t.$set(t.scriptForm.session,"value",e)},expression:"scriptForm.session.value"}},[n("el-option",{attrs:{label:"关闭",value:0}}),t._l(20,function(t){return n("el-option",{key:"session-"+t,attrs:{label:t,value:t}})})],2),n("el-cascader",{staticClass:"manual-instruct",attrs:{"show-all-levels":!1,options:t.instructOptions(2)},model:{value:t.scriptForm.session.instruct,callback:function(e){t.$set(t.scriptForm.session,"instruct",e)},expression:"scriptForm.session.instruct"}})],1),0!==t.scriptForm.session.value?n("el-form-item",{attrs:{label:"话术",prop:"session"}},[n("el-input",{attrs:{placeholder:"请输入到达该会话轮数转人工时所播放的话术",maxlength:"60"},model:{value:t.scriptForm.session.text,callback:function(e){t.$set(t.scriptForm.session,"text",e)},expression:"scriptForm.session.text"}}),n("voice-upload",{attrs:{fileInfo:t.scriptForm.session.audio,errorInfo:t.scriptForm.session.voiceError},on:{getUploadInfo:function(e){t.getUploadInfo(arguments,{type:"session"})}}})],1):t._e()]:t._e(),n("h6",[n("label",[t._v("意向性设置")]),n("Tooltip",{attrs:{content:t.scriptTooltip.intention}})],1),n("Intention",{model:{value:t.scriptForm.intentionType,callback:function(e){t.$set(t.scriptForm,"intentionType",e)},expression:"scriptForm.intentionType"}}),n("el-form-item",[n("el-button",{staticClass:"save-btn",class:{"loading-btn":t.scriptFormLoading},attrs:{type:"primary",disabled:t.scriptFormLoading},on:{click:t.saveForm}},[n("Loading",{directives:[{name:"show",rawName:"v-show",value:t.scriptFormLoading,expression:"scriptFormLoading"}]}),t._v("\n          保存\n      ")],1)],1)],2),n("Modal",{staticClass:"modal-padding-16 modal-ivrnode",attrs:{draggable:"",title:t.ivrnodeModalTitle},on:{comfirm:t.saveIvrnode,cancel:t.closeIvrnodeModal},model:{value:t.ivrnodeModal,callback:function(e){t.ivrnodeModal=e},expression:"ivrnodeModal"}},[n("el-form",{ref:"ivrnodeForm",staticClass:"form-has-tootip",attrs:{model:t.ivrnodeForm,rules:t.ivrnodeRules,"label-width":"88px"}},[n("el-form-item",{staticClass:"ivrnode-clusters",attrs:{prop:"cluster_id"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("聚类"),n("Tooltip",{attrs:{content:t.scriptTooltip.clusters}})],1),n("el-select",{attrs:{filterable:"",placeholder:"请选择聚类名称"},model:{value:t.ivrnodeForm.cluster_id,callback:function(e){t.$set(t.ivrnodeForm,"cluster_id",e)},expression:"ivrnodeForm.cluster_id"}},t._l(t.clustersList,function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id,title:t.title}})}))],1),t.matchList.content?n("el-form-item",{staticClass:"clusters-name-list",attrs:{label:"聚类名称"}},[n("div",{staticClass:"tags-pure-collection"},t._l(t.matchList.content,function(e,i){return n("span",{key:"match-"+i,staticClass:"text-tag"},[t._v("\n            "+t._s(e)+"\n          ")])}))]):t._e(),n("el-form-item",{attrs:{label:"话术",prop:"script"}},[n("editable-textarea",{attrs:{selectList:t.fieldsList},model:{value:t.ivrnodeForm.script,callback:function(e){t.$set(t.ivrnodeForm,"script",e)},expression:"ivrnodeForm.script"}})],1),n("el-form-item",{staticClass:"form-item-voice-upload"},[n("voice-upload",{ref:"ivrnodeUpload",staticClass:"ivrnode-voice-upload",attrs:{fileInfo:t.ivrnodeForm.audio,errorInfo:t.ivrnodeForm.voiceError},on:{getUploadInfo:function(e){t.getUploadInfo(arguments,{type:"node"})}}},[n("el-button",{attrs:{type:"primary"}},[t._v("选择语音文件")])],1)],1),n("el-form-item",{attrs:{prop:"label_id"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("标签"),n("Tooltip",{attrs:{content:t.scriptTooltip.labels}})],1),n("el-cascader",{attrs:{filterable:"",placeholder:"请选择标签",options:t.labelsOptions,"show-all-levels":!1,"popper-class":"cascader-width164"},model:{value:t.ivrnodeForm.label_id,callback:function(e){t.$set(t.ivrnodeForm,"label_id",e)},expression:"ivrnodeForm.label_id"}})],1),n("el-form-item",{staticClass:"line-height-20",attrs:{prop:"mainprocess"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("指令"),n("Tooltip",{attrs:{content:t.scriptTooltip.directives}})],1),n("span",{staticClass:"mrr-20",on:{click:function(e){return e.preventDefault(),t.mainprocessTip(e)}}},[n("el-checkbox",{attrs:{label:"未匹配继续流程"},model:{value:t.ivrnodeForm.default,callback:function(e){t.$set(t.ivrnodeForm,"default",e)},expression:"ivrnodeForm.default"}})],1),n("span",[n("el-checkbox",{attrs:{label:"流程结束节点",disabled:!t.ivrnodeForm.node_end},model:{value:t.ivrnodeForm.process_end,callback:function(e){t.$set(t.ivrnodeForm,"process_end",e)},expression:"ivrnodeForm.process_end"}})],1)]),n("el-form-item",{staticClass:"line-height-30 ivrnode-directive directive-artificial",attrs:{prop:"instruct_manual"}},[n("span",{staticClass:"mrr-20"},[n("el-checkbox",{attrs:{label:"允许打断"},model:{value:t.ivrnodeForm.bargein,callback:function(e){t.$set(t.ivrnodeForm,"bargein",e)},expression:"ivrnodeForm.bargein"}})],1),t.callcenter?n("span",{on:{click:function(e){e.preventDefault(),t.changeArtificial(!t.ivrnodeForm.instruct_manual)}}},[n("el-checkbox",{attrs:{label:"转为人工坐席",disabled:t.ivrnodeForm.bargein},model:{value:t.ivrnodeForm.instruct_manual,callback:function(e){t.$set(t.ivrnodeForm,"instruct_manual",e)},expression:"ivrnodeForm.instruct_manual"}}),t.ivrnodeForm.instruct_manual?n("el-select",{staticClass:"service-groups",attrs:{filterable:"",placeholder:"请选择技能组","popper-class":"select-width138"},model:{value:t.ivrnodeForm.manual_pid,callback:function(e){t.$set(t.ivrnodeForm,"manual_pid",e)},expression:"ivrnodeForm.manual_pid"}},t._l(t.serviceGroups,function(t){return n("el-option",{key:t.path,attrs:{label:t.name,value:t.gid,title:t.name}})})):t._e()],1):t._e()]),n("el-form-item",{staticClass:"ivrnode-directive line-height-30",attrs:{prop:"instruct_sms"}},[n("span",{staticClass:"mrr-20"},[n("el-checkbox",{attrs:{label:"允许问题跳转"},model:{value:t.ivrnodeForm.allow_jump,callback:function(e){t.$set(t.ivrnodeForm,"allow_jump",e)},expression:"ivrnodeForm.allow_jump"}})],1),t.EpInfo.sms_count?n("span",[n("el-checkbox",{attrs:{label:"发送短信"},on:{change:t.changeSms},model:{value:t.ivrnodeForm.instruct_sms,callback:function(e){t.$set(t.ivrnodeForm,"instruct_sms",e)},expression:"ivrnodeForm.instruct_sms"}}),t.ivrnodeForm.instruct_sms?n("el-select",{staticClass:"msm-groups",attrs:{filterable:"",placeholder:"请选择短信","popper-class":"select-width138"},model:{value:t.ivrnodeForm.sms_template_id,callback:function(e){t.$set(t.ivrnodeForm,"sms_template_id",e)},expression:"ivrnodeForm.sms_template_id"}},t._l(t.messagesList,function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id,title:t.title}})})):t._e()],1):t._e()])],1)],1),n("contextmenu",{ref:"contextmenu"},[n("contextmenu-item",{on:{click:function(e){t.openIvrnodeModal(t.treeHandler.ADD)}}},[t._v("新增")]),n("contextmenu-item",{on:{click:function(e){t.openIvrnodeModal(t.treeHandler.EDIT)}}},[t._v("编辑")]),n("contextmenu-item",{on:{click:t.handleCopy}},[t._v("复制")]),t.type===t.treeHandler.COPY?n("contextmenu-item",{on:{click:function(e){t.handleTree(t.treeHandler.PASTE)}}},[t._v("粘贴")]):t._e(),n("contextmenu-item",{on:{click:t.removeNode}},[t._v("删除")])],1)],1)},[],!1,null,null,null));e.default=P.exports},WQji:function(t,e,n){"use strict";var i={name:"toop-tip",props:{content:String},data:function(){return{show:!1}},methods:{toggleTip:function(t){this.show=t}}},r=(n("CoYH"),n("KHd+")),o=Object(r.a)(i,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tool-tip"},[e("span",{staticClass:"tool-tip-icon"}),e("div",{staticClass:"tool-tip-content"},[this._t("default",[this._v("\n        "+this._s(this.content)+"\n      ")])],2)])},[],!1,null,null,null);e.a=o.exports},"X+n+":function(t,e,n){"use strict";function i(t,e){return void 0===e&&(e=12),+parseFloat(t.toPrecision(e))}function r(t){var e=t.toString().split(/[eE]/),n=(e[0].split(".")[1]||"").length-+(e[1]||0);return n>0?n:0}function o(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var e=r(t);return e>0?t*Math.pow(10,e):t}function a(t){t>Number.MAX_SAFE_INTEGER||Number.MIN_SAFE_INTEGER}function s(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(n.length>0)return s.apply(void 0,[s(t,e),n[0]].concat(n.slice(1)));var l=o(t),c=o(e),u=r(t)+r(e),d=l*c;return a(d),d/Math.pow(10,u)}function l(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(n.length>0)return l.apply(void 0,[l(t,e),n[0]].concat(n.slice(1)));var o=Math.pow(10,Math.max(r(t),r(e)));return(s(t,o)+s(e,o))/o}function c(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(n.length>0)return c.apply(void 0,[c(t,e),n[0]].concat(n.slice(1)));var o=Math.pow(10,Math.max(r(t),r(e)));return(s(t,o)-s(e,o))/o}function u(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(n.length>0)return u.apply(void 0,[u(t,e),n[0]].concat(n.slice(1)));var l=o(t),c=o(e);return a(l),a(c),s(l/c,Math.pow(10,r(e)-r(t)))}function d(t,e){var n=Math.pow(10,e);return u(Math.round(s(t,n)),n)}Object.defineProperty(e,"__esModule",{value:!0});var m={strip:i,plus:l,minus:c,times:s,divide:u,round:d,digitLength:r,float2Fixed:o};e.strip=i,e.plus=l,e.minus=c,e.times=s,e.divide=u,e.round=d,e.digitLength=r,e.float2Fixed=o,e.default=m},ZNLe:function(t,e,n){},mEzX:function(t,e,n){},mrpR:function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n={inserted:function(t,e,n){var i=n.context.$refs[e.arg];i.addRef({el:t,vnode:n}),i.$contextmenuId=t.id||i._uid}};var i={render:function(){var t=this.$createElement;return(this._self._c||t)("ul",{directives:[{name:"show",rawName:"v-show",value:this.visible,expression:"visible"}],ref:"contextmenu",class:this.contextmenuCls,style:this.style},[this._t("default")],2)},staticRenderFns:[],name:"VContextmenu",provide:function(){return{$$contextmenu:this}},props:{eventType:{type:String,default:"contextmenu"},theme:{type:String,default:"default"},autoPlacement:{type:Boolean,default:!0}},data:function(){return{visible:!1,references:[],style:{top:0,left:0}}},computed:{clickOutsideHandler:function(){return this.visible?this.hide:function(){}},isClick:function(){return"click"===this.eventType},contextmenuCls:function(){return["v-contextmenu","v-contextmenu--"+this.theme]}},watch:{visible:function(t){t?(this.$emit("show",this),document.body.addEventListener("click",this.handleBodyClick)):(this.$emit("hide",this),document.body.removeEventListener("click",this.handleBodyClick))}},mounted:function(){var t,e,n;document.body.appendChild(this.$el),window.$$VContextmenu?window.$$VContextmenu[this.$contextmenuId]=this:window.$$VContextmenu=(t={},e=this.$contextmenuId,n=this,e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t)},beforeDestroy:function(){var t=this;document.body.removeChild(this.$el),delete window.$$VContextmenu[this.$contextmenuId],this.references.forEach(function(e){e.el.removeEventListener(t.eventType,t.handleReferenceContextmenu)}),document.body.removeEventListener("click",this.handleBodyClick)},methods:{addRef:function(t){this.references.push(t),t.el.addEventListener(this.eventType,this.handleReferenceContextmenu)},handleReferenceContextmenu:function(t){var e=this;t.preventDefault();var n=this.references.find(function(e){return e.el.contains(t.target)});this.$emit("contextmenu",n?n.vnode:null);var i=t.pageX,r=t.pageY;this.show(),this.$nextTick(function(){var t={top:r,left:i};if(e.autoPlacement){var n=e.$refs.contextmenu.clientWidth,o=e.$refs.contextmenu.clientHeight;o+r>=window.innerHeight&&(t.top-=o),n+i>=window.innerWidth&&(t.left-=n)}e.style={top:t.top+"px",left:t.left+"px"}})},handleBodyClick:function(t){this.$el.contains(t.target)||this.isClick&&this.references.some(function(e){return e.el.contains(t.target)})||(this.visible=!1)},show:function(t){var e=this;Object.keys(window.$$VContextmenu).forEach(function(t){t!==e.$contextmenuId&&window.$$VContextmenu[t].hide()}),t&&(this.style={top:t.top+"px",left:t.left+"px"}),this.visible=!0},hide:function(){this.visible=!1},hideAll:function(){Object.keys(window.$$VContextmenu).forEach(function(t){window.$$VContextmenu[t].hide()})}}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return this.divider?e("li",{staticClass:"v-contextmenu-divider"}):e("li",{class:this.classname,on:{click:this.handleClick,mouseenter:this.handleMouseenter,mouseleave:this.handleMouseleave}},[this._t("default")],2)},staticRenderFns:[],name:"VContextmenuItem",inject:["$$contextmenu"],props:{divider:Boolean,disabled:Boolean,autoHide:{type:Boolean,default:!0}},data:function(){return{hover:!1}},computed:{classname:function(){return{"v-contextmenu-item":!this.divider,"v-contextmenu-item--hover":this.hover,"v-contextmenu-item--disabled":this.disabled}}},methods:{handleMouseenter:function(t){this.disabled||(this.hover=!0,this.$emit("mouseenter",this,t))},handleMouseleave:function(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))},handleClick:function(t){this.disabled||(this.$emit("click",this,t),this.autoHide&&this.$$contextmenu.hide())}}};var o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{class:t.classname,on:{mouseenter:t.handleMouseenter,mouseleave:t.handleMouseleave}},[n("span",{staticClass:"v-contextmenu-submenu__title"},[t._t("title",[t._v(t._s(t.title))]),t._v(" "),n("span",{staticClass:"v-contextmenu-iconfont v-contextmenu-submenu__icon"})],2),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.hover,expression:"hover"}],ref:"submenu",class:t.submenuCls},[t._t("default")],2)])},staticRenderFns:[],name:"VContextmenuSubmenu",props:{title:String,disabled:Boolean},data:function(){return{hover:!1,submenuPlacement:[]}},computed:{classname:function(){return{"v-contextmenu-item":!0,"v-contextmenu-submenu":!0,"v-contextmenu-item--hover":this.hover,"v-contextmenu-item--disabled":this.disabled}},submenuCls:function(){return["v-contextmenu"].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this.submenuPlacement))}},methods:{handleMouseenter:function(t){var e=this;if(!this.disabled){var n=t.target.getBoundingClientRect();this.hover=!0,this.$emit("mouseenter",this,t),this.$nextTick(function(){var t=e.$refs.submenu.clientWidth,i=e.$refs.submenu.clientHeight,r=[];n.right+t>=window.innerWidth?r.push("left"):r.push("right"),n.bottom+i>=window.innerHeight?r.push("bottom"):r.push("top"),e.submenuPlacement=r})}},handleMouseleave:function(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))}}},a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"v-contextmenu-group"},[e("ul",{staticClass:"v-contextmenu-group__menus",style:this.menusStyle},[this._t("default")],2)])},staticRenderFns:[],name:"VContextmenuGroup",props:{maxWidth:[Number,String]},computed:{menusStyle:function(){return this.maxWidth?{"max-width":"number"==typeof this.maxWidth?this.maxWidth+"px":this.maxWidth,"overflow-x":"auto"}:null}}},s=function(t){t.directive("contextmenu",n),t.component(i.name,i),t.component(r.name,r),t.component(o.name,o),t.component(a.name,a)};"undefined"!=typeof window&&window.Vue&&s(window.Vue);var l={install:s};e.directive=n,e.Contextmenu=i,e.ContextmenuItem=r,e.ContextmenuSubmenu=o,e.ContextmenuGroup=a,e.default=l},nj8o:function(t,e,n){"use strict";var i=n("mEzX");n.n(i).a},xDdU:function(t,e,n){var i,r,o=n("4fRq"),a=n("I2ZF"),s=0,l=0;t.exports=function(t,e,n){var c=e&&n||0,u=e||[],d=(t=t||{}).node||i,m=void 0!==t.clockseq?t.clockseq:r;if(null==d||null==m){var p=o();null==d&&(d=i=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==m&&(m=r=16383&(p[6]<<8|p[7]))}var h=void 0!==t.msecs?t.msecs:(new Date).getTime(),f=void 0!==t.nsecs?t.nsecs:l+1,v=h-s+(f-l)/1e4;if(v<0&&void 0===t.clockseq&&(m=m+1&16383),(v<0||h>s)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=h,l=f,r=m;var b=(1e4*(268435455&(h+=122192928e5))+f)%4294967296;u[c++]=b>>>24&255,u[c++]=b>>>16&255,u[c++]=b>>>8&255,u[c++]=255&b;var g=h/4294967296*1e4&268435455;u[c++]=g>>>8&255,u[c++]=255&g,u[c++]=g>>>24&15|16,u[c++]=g>>>16&255,u[c++]=m>>>8|128,u[c++]=255&m;for(var y=0;y<6;++y)u[c+y]=d[y];return e||a(u)}},xk4V:function(t,e,n){var i=n("4fRq"),r=n("I2ZF");t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||r(a)}},"z/lk":function(t,e,n){"use strict";var i=n("AaNj");n.n(i).a}}]);