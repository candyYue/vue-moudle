(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"/3Ly":function(t,e,r){},"/cND":function(t,e,r){"use strict";var s=r("gJZZ");r.n(s).a},"0SQa":function(t,e,r){"use strict";var s=r("z/u3");r.n(s).a},AAoU:function(t,e,r){"use strict";r("f3/d"),r("xfY5"),r("ls82");var s,n=r("MECJ"),l=(r("rGqo"),r("yt8O"),r("/8Fb"),r("QIt3")),a=r("iYJL"),o={name:"progress-modal",props:{value:{type:Boolean,default:!1},dataKey:{type:String},title:{type:String,default:"导入"},importUrl:String,importData:Object,getList:Function,onError:Function},data:function(){return{api:l.a,hash:null,result:{}}},computed:{successStatus:function(){return 100===this.result.per}},watch:{value:function(t){t&&this.startImport()}},methods:{startImport:function(){var t=this,e=new FormData;Object.entries(this.importData).map(function(t){e.append(t[0],t[1])});var r=new XMLHttpRequest;r.open("POST",this.importUrl,!0),r.send(e),r.onload=function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(s){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:4===r.readyState&&200===r.status&&(0===(n=JSON.parse(r.responseText||r.response)).status?(t.hash=n.data.hash,t.getProgress()):(t.onError?t.onError(n.info):t.$messageTip.$error({content:n.info}),t.close()));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},getProgress:(s=Object(n.a)(regeneratorRuntime.mark(function t(){var e,r,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=null,t.next=3,Object(a.a)(l.a.AICall.getProgress,{hash:this.hash});case 3:if(r=t.sent,this.result=r.data,10004!==r.status){t.next=8;break}return this.close(),t.abrupt("return");case 8:100!==Number(r.data.per)?e=setTimeout(function(){s.getProgress(),clearTimeout(e)},1e3):(r.data.error||setTimeout(function(){s.close()},2e3),r.data.total-r.data.error&&this.getList());case 9:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)}),close:function(){this.$emit("input",!1)}}},i=(r("PcAL"),r("KHd+")),c={name:"import-modal",components:{ModalProgress:Object(i.a)(o,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Modal",{staticClass:"modal-padding-45 modal-progress",attrs:{title:t.dataKey+"导入",showFooter:!1,showClose:t.successStatus},on:{cancel:t.close},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[r("el-progress",{attrs:{"stroke-width":10,color:"#52BBFF",status:t.successStatus?"success":"",percentage:t.result.per||0}}),t.successStatus?r("div",[r("p",[t._v("导入完成，共"+t._s(t.result.total)+"条，导入成功"),r("span",{staticClass:"success-text"},[t._v(t._s(t.result.total-t.result.error))]),t._v("条，导入失败"),r("span",{staticClass:"error-text",attrs:{span:""}},[t._v(t._s(t.result.error))]),t._v("条，")]),t.result.error?r("p",[r("a",{attrs:{href:t.api.AICall.getImportReport+"?hash="+this.hash}},[t._v("下载错误报告")]),t._v("，查看失败原因。")]):t._e()]):r("div",[t._v("正在导入"+t._s(t.dataKey)+"数据...…")])],1)},[],!1,null,null,null).exports},props:{value:{type:Boolean,default:!1},dataKey:{type:String},title:{type:String,default:"导入"},templateUrl:String,importUrl:String,accept:{type:String,default:".csv"},getList:Function},data:function(){return{modal:!0,progressModal:!1,file:null,importData:{},errorInfo:""}},methods:{importFile:function(){this.$refs.fileInput.click(),this.$refs.fileButton.$el.blur()},handleChange:function(t){this.errorInfo="";var e=t.target.files[0];e.name.slice(-4)===this.accept?(this.file=e,this.importData={file:e}):this.errorInfo="请选择".concat(this.accept,"格式的文件")},handleSave:function(){this.file?(this.progressModal=!0,this.close()):this.errorInfo="请选择需要导入的文件"},close:function(){this.$emit("input",!1),this.$refs.fileInput.value=null,this.file=null}}},u=(r("0SQa"),Object(i.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Modal",{staticClass:"modal-padding-40 modal-import",attrs:{title:t.dataKey+"导入",comfirmText:"开始导入"},on:{comfirm:t.handleSave,cancel:t.close},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[r("div",{staticClass:"modal-import__descr"},[r("p",[t._v("1、请按照导入模板的格式来准备要导入的数据。"),r("a",{attrs:{href:t.templateUrl}},[t._v("下载导入模板")])]),r("p",[t._v("2、选择需要导入的CSV文件")])]),r("p",[r("el-button",{ref:"fileButton",attrs:{type:"info"},on:{click:t.importFile}},[t._v("选择文件")]),t.errorInfo?r("span",{staticClass:"modal-import__info modal-import__error"},[t._v(t._s(t.errorInfo))]):r("span",{staticClass:"modal-import__info modal-import__file-name"},[t._v(t._s(t.file&&t.file.name))])],1),r("input",{ref:"fileInput",attrs:{type:"file",hidden:"",accept:t.accept},on:{change:t.handleChange}})]),r("modal-progress",{attrs:{"data-key":t.dataKey,"import-url":t.importUrl,"import-data":t.importData,getList:t.getList},model:{value:t.progressModal,callback:function(e){t.progressModal=e},expression:"progressModal"}})],1)},[],!1,null,null,null));e.a=u.exports},Cwky:function(t,e,r){"use strict";r.d(e,"f",function(){return l}),r.d(e,"c",function(){return a}),r.d(e,"a",function(){return o}),r.d(e,"b",function(){return i}),r.d(e,"d",function(){return c}),r.d(e,"e",function(){return u});var s=r("oI6n"),n={required:!0,message:"请输入话术内容",trigger:["blur","change"]},l={title:[{required:!0,message:"请输入话术名称",trigger:["blur","change"]},{validator:function(t,e,r){s.b.test(e)?r(new Error("请不要输入非法字符")):r()},trigger:["blur","change"]}],"noinput[0].text":[n,s.a],"noinput[1].text":[n,s.a],"noinput[2].text":[n,s.a],"nomatch[0].text":[n,s.a],"nomatch[1].text":[n,s.a],"nomatch[2].text":[n,s.a],intention:{validator:function(t,e,r){if(e.value&&!e.text)return r(new Error("请输入话术"));r()},trigger:["blur","change"]},session:{validator:function(t,e,r){if(e.value&&!e.text)return r(new Error("请输入话术"));r()},trigger:["blur","change"]}},a={cluster_id:{required:!0,message:"请选择聚类名称",trigger:["blur","change"]},script:[{required:!0,message:"请输入话术",trigger:["blur","change"]},{validator:function(t,e,r){s.b.test(e)?r(new Error("请不要输入非法字符")):r()},trigger:["blur","change"]}]},o={title:[{required:!0,message:"请输入聚类名称",trigger:["blur","change"]},s.a]},i={title:[{required:!0,message:"请输入字段内容",trigger:["blur","change"]},s.a]},c={title:[{required:!0,message:"请输入标签内容",trigger:["blur","change"]},s.a]},u={title:[{required:!0,message:"请输入短信名称",trigger:["blur","change"]},s.a],content:[{required:!0,message:"请输入短信内容",trigger:["blur","change"]},s.a]}},D3x0:function(t,e,r){"use strict";var s=r("/3Ly");r.n(s).a},PcAL:function(t,e,r){"use strict";var s=r("t537");r.n(s).a},bcP3:function(t,e,r){"use strict";r.r(e);r("rGqo"),r("yt8O"),r("T39b");var s=r("iv4g"),n=r("yT7P"),l=(r("91GP"),r("Z2Ku"),r("L9s1"),r("L2JU")),a=r("gXkj"),o=r("AAoU"),i=r("Cwky"),c=r("oI6n"),u=r("nc4g"),d=r("+7xr"),m=r("QIt3"),p={components:{ModalImport:o.a},data:function(){var t=this;return{api:m.a,clusterLimit:2e3,clusterRules:Object.assign(i.a,{clustersTemp:[{validator:function(e,r,s){return r&&c.b.test(r)?s(new Error("请不要输入非法字符")):0===t.clusterform.content.length?s(new Error("请输入聚类文本集合")):r&&c.b.test(r)?s(new Error("请不要输入非法字符")):r&&t.clusterform.content.includes(r)?s(new Error("聚类集合文本不能相同")):t.clusterform.content.length===t.clusterLimit?s(new Error("此聚类已达".concat(t.clusterLimit,"个文本，无法继续添加"))):void s()},trigger:"none"}]}),clusterModal:!1,clustersImport:!1,modalType:0,clusterModalTit:{0:"新建聚类",1:"编辑聚类"},clusterform:{id:"",title:"",content:[],clustersTemp:""},loading:!1}},computed:Object(n.a)({},Object(l.c)({clustersListTotal:"AICall/clustersListTotal",clustersList:"AICall/clustersList"})),methods:Object(n.a)({},Object(l.b)({getClusters:"AICall/getClusters",delClusters:"AICall/delClusters",saveClusters:"AICall/saveClusters"}),{addClusters:function(){this.$refs.clustersTemp.clearValidate();var t=this.clusterform.content.length;if(this.clusterform.clustersTemp){if(t>=1&&(this.$refs.clusterform.validateField("clustersTemp"),t===this.clusterLimit))return!1;if(c.b.test(this.clusterform.clustersTemp))return this.$refs.clusterform.validateField("clustersTemp"),!1;var e=Object(s.a)(this.clusterform.content);e.unshift(this.clusterform.clustersTemp),this.clusterform.clustersTemp="",this.clusterform.content=Object(s.a)(new Set(e))}else this.$refs.clusterform.validateField("clustersTemp")},removeClusters:function(t){var e=Object(s.a)(this.clusterform.content);e.splice(t,1),this.clusterform.content=e},handleImport:function(){this.clustersImport=!0},handleNew:function(){if(this.clustersListTotal>=1e3)return a.b.$warning({content:"您的聚类数量已达1000个，无法新建"}),!1;this.openModal(),this.modalType=0,this.clusterform.id=""},handleEdit:function(t){var e=t.id,r=t.title,s=t.content;this.modalType=1,this.openModal(),this.clusterform={id:e,title:r,content:s}},handleDelete:function(t){var e=this;a.a.$error({title:"删除提示",content:"您确定要删除该聚类吗？<br/>删除将会影响相应话术的使用。",comfirmText:"确定删除",btnChange:!0,successCallback:function(){e.delClusters({id:t}).then(function(t){0===t.status&&(u.a.$emit("reloadList",d.PAGE_HANDLER.DEL),a.b.$success({content:"删除成功"}))})}})},handleSave:function(){var t=this,e=this.clusterform,r={id:e.id,content:e.content,title:e.title};this.$refs.clusterform.validate(function(e){if(!e)return!1;t.loading=!0,t.saveClusters(r).then(function(e){0===e.status&&(t.closeModal(),a.b.$success({content:"保存成功"}),0===t.modalType?u.a.$emit("reloadList",d.PAGE_HANDLER.ADD):u.a.$emit("reloadList",d.PAGE_HANDLER.EDIT)),t.loading=!1})})},getImportList:function(){u.a.$emit("reloadList",d.PAGE_HANDLER.ADD)},openModal:function(){this.clusterModal=!0,this.clusterform.content=[],this.$refs.clusterform.resetFields(),this.loading=!1},closeModal:function(){this.clusterModal=!1}})},f=(r("/cND"),r("D3x0"),r("KHd+")),h=Object(f.a)(p,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("table-pagination",{attrs:{name:"聚类",importAction:!0,router:"AICall-talk-clusters",pageKey:"clusters",total:t.clustersListTotal},on:{handleNew:t.handleNew,handleImport:t.handleImport,getList:t.getClusters}},[r("el-table",{attrs:{data:t.clustersList}},[r("el-table-column",{attrs:{prop:"title",label:"聚类名称",align:"left",width:"200px"}}),r("el-table-column",{attrs:{prop:"content",label:"文本集合","class-name":"tags-cell"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{attrs:{title:e.row.content.join(" / ")}},[t._v(t._s(e.row.content.join(" / ")))])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"100","class-name":"visible-cell"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(r){t.handleEdit(e.row)}}}),r("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(r){t.handleDelete(e.row.id)}}})]}}])})],1)],1),r("Modal",{class:{"modal-has-tip":1===t.modalType},attrs:{title:t.clusterModalTit[t.modalType],draggable:"",loading:t.loading},on:{cancel:t.closeModal,comfirm:t.handleSave},model:{value:t.clusterModal,callback:function(e){t.clusterModal=e},expression:"clusterModal"}},[1===t.modalType?r("p",{staticClass:"modal-tip"},[t._v("所编辑的聚类需要在相应的话术编辑页面进行保存才可生效。")]):t._e(),r("el-form",{ref:"clusterform",attrs:{model:t.clusterform,rules:t.clusterRules,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"聚类名称",prop:"title"}},[r("el-input",{attrs:{maxlength:"20"},model:{value:t.clusterform.title,callback:function(e){t.$set(t.clusterform,"title","string"==typeof e?e.trim():e)},expression:"clusterform.title"}})],1),r("el-form-item",{ref:"clustersTemp",staticClass:"required-form",attrs:{label:"聚类文本集合",prop:"clustersTemp"}},[r("div",{staticClass:"flex-layout-form"},[r("el-input",{attrs:{maxlength:"15"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.addClusters(e):null}},model:{value:t.clusterform.clustersTemp,callback:function(e){t.$set(t.clusterform,"clustersTemp","string"==typeof e?e.trim():e)},expression:"clusterform.clustersTemp"}}),r("el-button",{staticClass:"button__add",attrs:{icon:"el-icon-plus",size:"mini"},on:{click:t.addClusters}})],1)]),t.clusterform.content.length?r("div",{staticClass:"tags-collection"},t._l(t.clusterform.content,function(e,s){return r("span",{key:s,staticClass:"text-tag"},[t._v("\n            "+t._s(e)+"\n            "),r("i",{staticClass:"el-icon-close",on:{click:function(e){t.removeClusters(s)}}})])})):t._e()],1)],1),r("modal-import",{attrs:{"data-key":"聚类","template-url":t.api.AICall.tmpClusters,"import-url":t.api.AICall.impClusters,"get-list":t.getImportList},model:{value:t.clustersImport,callback:function(e){t.clustersImport=e},expression:"clustersImport"}})],1)},[],!1,null,"6e5f2927",null);e.default=h.exports},gJZZ:function(t,e,r){},oI6n:function(t,e,r){"use strict";r.d(e,"b",function(){return s}),r.d(e,"a",function(){return n});var s=/[<>&'"]{1,}/,n={validator:function(t,e,r){e&&s.test(e)&&r(new Error("请不要输入非法字符")),r()},trigger:["change","blur"]}},t537:function(t,e,r){},"z/u3":function(t,e,r){}}]);