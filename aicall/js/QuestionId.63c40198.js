(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{LTCd:function(e,t,s){"use strict";var i=s("xeLW");s.n(i).a},qJhF:function(e,t,s){"use strict";s.r(t);s("KKXr"),s("ls82");var i,r,o=s("MECJ"),n=(s("FLlr"),s("rGqo"),s("yT7P")),a=(s("Z2Ku"),s("L9s1"),s("VRzm"),s("L2JU")),u=s("gXkj"),l=s("9qKe"),c=s("Y+6y"),d=s("PEHn"),m=s("eulG"),p=s("9y2E"),f=s("oI6n"),h={data:function(){var e=this;return{scriptsArr:[],cascaderList:{},questionForm:{common:[""],standard:"",answer:"",audio_id:"",file_name:"",src:"",duration:"",label:[],group_id:"",bindscript:[],scriptnode:[[]],jump_text:"",jump_type:"",jump_audio_id:"",jump_audio_name:"",onhook:!1,repeat:!1,manual:!1,manual_pid:"",send_sms:!1,message_id:"",interrupt:!1},disabledScript:[],jumpscript:[{value:1,label:"跳转至话术文本"},{value:2,label:"跳转至话术节点"}],questionRules:{standard:[{required:!0,message:"请输入客户可能问的问题",trigger:["change","blur"]},{validator:function(t,s,i){return s&&f.b.test(s)?i(new Error("请不要输入非法字符")):e.questionForm.common.includes(s)?i(new Error("相似问题已有同样问题")):void i()},trigger:["change","blur"]}]},answerrule:[{required:!0,message:"请输入机器人回答",trigger:"blur"},f.a],scriptrule:[{required:!0,message:"请选择问题话术"}],audiorule:[{required:!0}],scriptnoderule:[{validator:function(t,s,i){return 0===e.questionForm.bindscript.length?i(new Error("所属话术不能为空")):s.length&&1!==s.length?void i():i(new Error("请选择话术节点"))}},{required:!0}],scripttextrule:[{required:!0,message:"请输入话术内容",trigger:"blur"},f.a],commonrule:[{validator:function(t,s,i){if(s&&f.b.test(s))return i(new Error("请不要输入非法字符"));if(e.questionForm.standard&&s===e.questionForm.standard)return i(new Error("相似问题不能和标准问题相同"));var r=+t.field.slice(7,-1),o=e.questionForm.common.filter(function(e,t){return t!==r});if(s&&o.includes(s))return i(new Error("该相似问题已存在"));i()},trigger:["change","blur"]}],jump_filerule:[{required:!0}],showanswermessage:!0,serviceGroupsId:"",sendMessageId:"",saveLoading:!1,isNarrow:!1,disabled:!1,errorInfo:"",fileInfo:{audio_id:"",file_name:"",src:"",duration:""},scriptfileInfo:{},scripterrorInfo:""}},components:{Breadcrumb:l.a,Loading:c.a,VoiceUpload:d.a},watch:{questionForm:{handler:function(e,t){0===e.common.length?this.isNarrow=!0:this.isNarrow=!1},deep:!0}},computed:Object(n.a)({},Object(a.c)({serviceGroups:"AICall/serviceGroups",EpInfo:"AICall/EpInfo",messagesListTotal:"AICall/messagesListTotal",messagesList:"AICall/messagesList",scriptList:"AICall/scriptList",labelsList:"AICall/labelsList"}),{labelsOptions:function(){return this.labelsList.map(function(e){return{value:e.id,label:e.title,children:e.content?e.content.map(function(e){return{label:e,value:e}}):""}})||[]}}),methods:Object(n.a)({},Object(a.b)({questionDetail:"AICall/questionDetail",setQuestion:"AICall/setQuestion",getServiceGroups:"AICall/getServiceGroups",getEpInfo:"AICall/getEpInfo",getMessages:"AICall/getMessages",getScripts:"AICall/getScripts",getLabels:"AICall/getLabels"}),{activeItemChange:function(e,t){var s=this;if(this.cascaderList[t])this.cascaderList[t].path=e[0];else{var i=this.$refs["cascader-".concat(t)][0],r=i.menu.$el;this.cascaderList[t]={menu:r},r.addEventListener("click",function(r){var o=s.cascaderList[t].path?Object(p.b)(s.cascaderList[t].path):e[0];if(1===o.length)return!1;"LI"===r.target.nodeName.toUpperCase()&&i.handlePick(o,!0)},!1),r.addEventListener("mouseover",function(e){"LI"===e.target.nodeName.toUpperCase()&&e.target.setAttribute("title",e.target.innerText)},!1)}},changeJumpType:function(){this.scripterrorInfo="",2===this.questionForm.jump_type&&(this.$refs.questionForm.clearValidate(["jump_text"]),this.changescript(this.questionForm.bindscript))},repeatChange:function(e){e?(this.answerrule=[{required:!1}],this.audiorule=[{required:!1}],this.showanswermessage=!1,this.disabled=!0,this.errorInfo=""):(this.answerrule=[{required:!0,message:"请输入机器人回答",trigger:"blur"}],this.audiorule=[{required:!0}],this.showanswermessage=!0,this.$refs.questionForm.validateField("answer"),this.$refs.questionForm.validateField("audio_id"),this.disabled=!1)},removeScript:function(e){var t=this;this.questionForm.scriptnode.map(function(s,i){s[0]===e&&(t.questionForm.scriptnode[i]=[],0===i?t.questionForm.scriptnode[i]=[]:t.questionForm.scriptnode.splice(i,1))})},jumpNode:function(e,t){switch(e){case 1:this.questionForm.scriptnode.length<this.questionForm.bindscript.length&&this.questionForm.scriptnode.push([]);break;case-1:this.questionForm.scriptnode.splice(t,1)}},getUploadInfo:function(e,t){1===t&&(this.fileInfo=e[0],this.questionForm=Object(n.a)({},this.questionForm,e[0]),this.audiorule=[{required:!1}]),2===t&&(this.scriptfileInfo=e[0],this.jump_filerule=[{required:!1}],this.questionForm.jump_audio_id=e[0].audio_id,this.questionForm.jump_audio_name=e[0].file_name)},submitForm:function(e){var t=this;return this.questionForm.manual&&""===this.serviceGroupsId?(u.b.$error({content:"请选择技能组"}),!1):this.questionForm.send_sms&&""===this.sendMessageId?(u.b.$error({content:"请选择短信"}),!1):void this.$refs[e].validate(function(e,s){if(!e)return s.audio_id&&(t.errorInfo="请上传语音"),s.jump_file&&(t.scripterrorInfo="请上传语音"),!1;t.errorInfo="",t.saveLoading=!0;var i=t.questionForm,r=i.standard,o=i.common,n=i.answer,a=i.audio_id,l=i.src,c=i.duration,d=(i.bindscript,i.jump_text),p=i.jump_type,f=i.jump_audio_id,h=i.jump_audio_name,q=[],b=[];t.questionForm.bindscript.filter(function(e){t.scriptList.filter(function(t){e===t.id&&q.push({id:t.id,name:t.title})})}),2===t.questionForm.jump_type?(t.questionForm.scriptnode.forEach(function(e){var t=e.join("-");b.push({id:e[0],name:Object(m.c)(e[0]),jump_node:{id:t,name:Object(m.d)(t)}})}),q.filter(function(e){return b.map(function(e){return e.id}).includes(e.id)||b.push(e),b})):b=q.concat();var g={standard:r,common:o,answer:n,audio_id:a,src:l,duration:c,jump_text:d,jump_type:p,jump_audio_id:f,jump_audio_name:h,scripts:JSON.stringify(b),label:t.questionForm.label.length?encodeURI(encodeURI(t.questionForm.label[t.questionForm.label.length-1])):"",group_id:t.questionForm.label.length?t.questionForm.label[0]:"",onhook:!0===t.questionForm.onhook?1:0,repeat:!0===t.questionForm.repeat?1:0,manual:!0===t.questionForm.manual?1:0,manual_pid:t.serviceGroupsId,send_sms:!0===t.questionForm.send_sms?1:0,message_id:t.sendMessageId,interrupt:!0===t.questionForm.interrupt?1:0},_=t.$route.meta,F=_.limit,v=_.page;"new"!==t.$route.params.id?g.id=t.$route.params.id:v=1,t.setQuestion(g).then(function(e){0===e.status?(u.b.$success({content:"保存成功！"}),t.saveLoading=!1,t.$router.push({name:"AICall-question",query:{limit:F,page:v}})):(u.b.$error({content:e.info}),t.saveLoading=!1)})})},removecommon:function(e){var t=this.questionForm.common.indexOf(e);-1!==t&&this.questionForm.common.splice(t,1)},addcommon:function(){this.questionForm.common.push(""),this.$nextTick(function(){this.$refs.questionArr[this.$refs.questionArr.length-1].focus()})},changescript:function(e){var t=this;this.scriptsArr=[],e.map(function(e){t.getScript(e)})},filterScriptsArr:function(e){var t=this.questionForm.scriptnode.map(function(e){return e[0]}),s=Object(p.b)(this.scriptsArr);return s.map(function(s,i){s.value!==t[e]&&t.includes(s.value)&&(s.disabled=!0)}),s},getScript:(r=Object(o.a)(regeneratorRuntime.mark(function e(t){var s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new m.a(t),e.next=3,s.getAllNodes();case 3:i=e.sent,this.scriptsArr.push(i);case 5:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),currentbindscript:function(e){var t=[];return this.scriptList.filter(function(s){e.filter(function(e){s.id===e.id&&t.push(e)})}),t}}),mounted:(i=Object(o.a)(regeneratorRuntime.mark(function e(){var t,s,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getScripts(),this.getLabels(),"new"===this.$route.params.id){e.next=8;break}return this.fullLoading=this.$loading({lock:!0,background:"rgba(180, 188, 205, 0.35)"}),t=this.$route.params.id,s=this,e.next=8,this.questionDetail({id:t}).then(function(e){if(0===e.status){var t=e.data,r=t.standard,o=t.answer,a=t.audio_id,u=(t.audio_name,t.src),l=t.duration,c=t.jump_text,d=t.jump_audio_id,m=t.jump_audio_name;if(s.questionForm={common:e.data.common?e.data.common.filter(function(e){return e}):[""],standard:r,answer:o,audio_id:e.data.audio_id?e.data.audio_id:"",file_name:e.data.audio_name,src:u,duration:l,jump_text:c,jump_type:e.data.jump_type||"",jump_audio_id:d,jump_audio_name:m,scriptnode:[[]],label:[+e.data.group_id,decodeURI(e.data.label)],onhook:1===e.data.onhook,repeat:1===e.data.repeat,manual:1===e.data.manual,send_sms:1===e.data.send_sms,interrupt:1===e.data.interrupt,bindscript:e.data.scripts&&e.data.scripts.length?s.currentbindscript(e.data.scripts).map(function(e){return e.id}):[]},e.data.scripts&&e.data.scripts.length&&2===e.data.jump_type){var p=s.questionForm.scriptnode,f=e.data.scripts.filter(function(e){return e.jump_node});f.length&&(p=f.map(function(e){return e.jump_node.id}).map(function(e){return e.split("-")}).map(function(e,t){return e[0]=+e[0],e})),s.questionForm.scriptnode=p,s.questionForm.bindscript.map(function(e){s.getScript(e)})}e.data.manual_pid&&(s.serviceGroupsId=+e.data.manual_pid),e.data.message_id&&(s.sendMessageId=+e.data.message_id),1===e.data.repeat&&(s.answerrule=[{required:!1}],s.audiorule=[{required:!1}],s.showanswermessage=!1,s.disabled=!0),e.data.jump_audio_id&&(s.jump_filerule=[{required:!1}]),s.fileInfo=Object(n.a)({},s.fileInfo,{audio_id:a,src:u,duration:l}),s.fileInfo.file_name=e.data.audio_name,s.scriptfileInfo={audio_id:d,file_name:e.data.jump_audio_name}}i.fullLoading.close()});case 8:this.getServiceGroups(),this.getEpInfo(),this.getMessages();case 11:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},q=(s("LTCd"),s("KHd+")),b=Object(q.a)(h,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"question-id"},[s("Breadcrumb",{attrs:{pathKey:"question"}}),s("el-form",{ref:"questionForm",attrs:{model:e.questionForm,rules:e.questionRules,"label-width":"100px"}},[s("el-form-item",{attrs:{prop:"standard",label:"标准问题"}},[s("el-input",{attrs:{placeholder:"请输入客户可能问的问题",maxlength:"30"},model:{value:e.questionForm.standard,callback:function(t){e.$set(e.questionForm,"standard","string"==typeof t?t.trim():t)},expression:"questionForm.standard"}})],1),e._l(e.questionForm.common,function(t,i){return s("el-form-item",{key:"common["+i+"]",staticClass:"commons_input",attrs:{label:0===i?"相似问题":"",prop:"common["+i+"]",rules:e.commonrule}},[s("el-input",{ref:"questionArr",refInFor:!0,attrs:{placeholder:"请输入与标准问题相似的问题",maxlength:"30"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.addcommon(t):null}},model:{value:e.questionForm.common[i],callback:function(t){e.$set(e.questionForm.common,i,"string"==typeof t?t.trim():t)},expression:"questionForm.common[index]"}}),s("el-button",{staticClass:"button__del",attrs:{icon:"el-icon-minus"},on:{click:function(s){s.preventDefault(),e.removecommon(t)}}})],1)}),s("el-form-item",[e.questionForm.common.length<2e3?s("div",{class:e.isNarrow?"narrow":"addquestion"},[s("el-button",{staticClass:"addcommon",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",plain:""},on:{click:e.addcommon}},[e._v("添加相似问题")])],1):e._e()]),s("el-form-item",{staticClass:"robot",attrs:{prop:"answer",label:"机器人回答","show-message":e.showanswermessage,rules:e.answerrule}},[s("div",[s("p",{staticClass:"tip"},[e._v("重复回答为机器人重复上一节点的话术，勾选后，机器人回答部分无法输入。")]),s("el-input",{attrs:{type:"textarea",rows:7,placeholder:"请输入回答",maxlength:"200",disabled:e.questionForm.repeat},model:{value:e.questionForm.answer,callback:function(t){e.$set(e.questionForm,"answer","string"==typeof t?t.trim():t)},expression:"questionForm.answer"}})],1)]),s("el-form-item",{staticClass:"audio",attrs:{prop:"audio_id","show-message":!1,rules:e.audiorule}},[s("voice-upload",{staticClass:"voice-upload",attrs:{disabled:e.disabled,errorInfo:e.errorInfo,fileInfo:e.fileInfo},on:{getUploadInfo:function(t){e.getUploadInfo(arguments,1)}}})],1),s("el-form-item",{staticClass:"bindscript",attrs:{prop:"bindscript",label:"所属话术",rules:e.scriptrule}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择话术"},on:{change:e.changescript,"remove-tag":e.removeScript},model:{value:e.questionForm.bindscript,callback:function(t){e.$set(e.questionForm,"bindscript",t)},expression:"questionForm.bindscript"}},e._l(e.scriptList,function(t,i){return s("el-option",{key:i,attrs:{label:t.title,value:t.id,title:t.title,disabled:e.disabledScript.filter(function(e){return e===t.id}).includes(t.id)}})}))],1),s("el-form-item",{staticClass:"select-width",attrs:{prop:"label",label:"标签"}},[s("el-cascader",{attrs:{filterable:"",clearable:"","show-all-levels":!1,options:e.labelsOptions,"popper-class":"cascader-width149",placeholder:"请选择标签"},model:{value:e.questionForm.label,callback:function(t){e.$set(e.questionForm,"label",t)},expression:"questionForm.label"}})],1),s("el-form-item",{attrs:{label:"跳转至话术"}},[s("el-select",{staticClass:"select-width",attrs:{placeholder:"请选择跳转类型",clearable:"","popper-class":"select-width300"},on:{change:e.changeJumpType},model:{value:e.questionForm.jump_type,callback:function(t){e.$set(e.questionForm,"jump_type",t)},expression:"questionForm.jump_type"}},e._l(e.jumpscript,function(e,t){return s("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),1===e.questionForm.jump_type?s("el-form-item",{staticClass:"scriptfile",attrs:{label:"话术内容",prop:"jump_text",rules:e.scripttextrule}},[s("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入话术内容",maxlength:"60"},model:{value:e.questionForm.jump_text,callback:function(t){e.$set(e.questionForm,"jump_text",t)},expression:"questionForm.jump_text"}})],1):e._e(),1===e.questionForm.jump_type?s("el-form-item",{staticClass:"scriptfile scriptfileaudio",attrs:{prop:"jump_file","show-message":!1,rules:e.jump_filerule}},[s("voice-upload",{attrs:{fileInfo:e.scriptfileInfo,errorInfo:e.scripterrorInfo},on:{getUploadInfo:function(t){e.getUploadInfo(arguments,2)}}})],1):e._e(),e._l(e.questionForm.scriptnode,function(t,i){return 2===e.questionForm.jump_type?s("el-form-item",{key:"scriptnode"+i,staticClass:"select-width",attrs:{label:"话术节点",prop:"scriptnode["+i+"]",rules:e.scriptnoderule}},[s("el-cascader",{ref:"cascader-"+i,refInFor:!0,attrs:{"show-all-levels":!1,clearable:"","expand-trigger":"hover",options:e.filterScriptsArr(i),"popper-class":"cascader-width300",placeholder:"请选择话术节点"},on:{"active-item-change":function(t){e.activeItemChange(arguments,i)}},model:{value:e.questionForm.scriptnode[i],callback:function(t){e.$set(e.questionForm.scriptnode,i,t)},expression:"questionForm.scriptnode[index]"}}),0!==i?s("el-button",{staticClass:"button__del cascader-button__del",attrs:{icon:"el-icon-minus"},on:{click:function(t){e.jumpNode(-1,i)}}}):e._e()],1):e._e()}),2===e.questionForm.jump_type&&e.questionForm.bindscript.length>1?s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",plain:""},on:{click:function(t){e.jumpNode(1)}}},[e._v("增加跳转节点")])],1):e._e(),s("el-form-item",{staticClass:"questionOrder",attrs:{label:"指令"}},[s("el-checkbox",{attrs:{disabled:e.questionForm.repeat||e.questionForm.interrupt||e.questionForm.manual},model:{value:e.questionForm.onhook,callback:function(t){e.$set(e.questionForm,"onhook",t)},expression:"questionForm.onhook"}},[e._v("结束后挂机")]),s("el-checkbox",{attrs:{disabled:e.questionForm.onhook||e.questionForm.interrupt||e.questionForm.manual||e.questionForm.send_sms},on:{change:e.repeatChange},model:{value:e.questionForm.repeat,callback:function(t){e.$set(e.questionForm,"repeat",t)},expression:"questionForm.repeat"}},[e._v("重复回答")]),"1"===e.EpInfo.enterprise_type?s("div",{staticClass:"serviceGroups"},[s("el-checkbox",{attrs:{disabled:e.questionForm.repeat||e.questionForm.onhook||e.questionForm.interrupt},model:{value:e.questionForm.manual,callback:function(t){e.$set(e.questionForm,"manual",t)},expression:"questionForm.manual"}},[e._v("转为人工坐席")]),s("el-select",{directives:[{name:"show",rawName:"v-show",value:e.questionForm.manual,expression:"questionForm.manual"}],staticClass:"select-groups",attrs:{placeholder:"请选择技能组","popper-class":"select-width170"},model:{value:e.serviceGroupsId,callback:function(t){e.serviceGroupsId=t},expression:"serviceGroupsId"}},e._l(e.serviceGroups,function(e){return s("el-option",{key:e.gid,attrs:{label:e.name,value:e.gid,title:e.name}})}))],1):e._e(),s("el-checkbox",{staticStyle:{width:"94px"},attrs:{disabled:e.questionForm.repeat||e.questionForm.onhook||e.questionForm.manual},model:{value:e.questionForm.interrupt,callback:function(t){e.$set(e.questionForm,"interrupt",t)},expression:"questionForm.interrupt"}},[e._v("允许打断")]),e.EpInfo.sms_count?s("div",{staticClass:"message"},[s("el-checkbox",{attrs:{disabled:e.questionForm.repeat},model:{value:e.questionForm.send_sms,callback:function(t){e.$set(e.questionForm,"send_sms",t)},expression:"questionForm.send_sms"}},[e._v("发送短信")]),s("el-select",{directives:[{name:"show",rawName:"v-show",value:e.questionForm.send_sms,expression:"questionForm.send_sms"}],staticClass:"select-groups",attrs:{placeholder:"请选择短信","popper-class":"select-width170"},model:{value:e.sendMessageId,callback:function(t){e.sendMessageId=t},expression:"sendMessageId"}},e._l(e.messagesList,function(e){return s("el-option",{key:e.id,attrs:{label:e.title,value:e.id,title:e.title}})}))],1):e._e()],1),s("el-form-item",{staticClass:"savequestion"},[s("el-button",{staticClass:"save-btn",class:{"loading-btn":e.saveLoading},attrs:{type:"primary",disabled:e.saveLoading},on:{click:function(t){e.submitForm("questionForm")}}},[e._v("\n          保存"),s("Loading",{directives:[{name:"show",rawName:"v-show",value:e.saveLoading,expression:"saveLoading"}]})],1)],1)],2)],1)},[],!1,null,null,null);t.default=b.exports},xeLW:function(e,t,s){}}]);